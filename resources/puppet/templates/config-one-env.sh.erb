#!/bin/bash

su -l oneadmin -c 'oneuser passwd oneadmin <%= @oneadmin_pw %>'
echo 'oneadmin:<%= @oneadmin_pw %>' > /var/lib/one/.one/one_auth
#su -l oneadmin -c 'onehost create master -i kvm -v kvm -n dummy'
#su -l oneadmin -c 'onehost create slave-1 -i kvm -v kvm -n dummy'
#su -l oneadmin -c 'onehost create slave-2 -i kvm -v kvm -n dummy'

su -l oneadmin << EOF

onevnet create /vagrant/resources/puppet/files/one-test-network.tmpl

while ! oneimage list | grep -q 'CentOS-6.5_64'
do
oneimage create \
--name "CentOS-6.5_64" \
--path "http://appliances.c12g.com/CentOS-6.5/centos6.5.qcow2.gz" \
--driver qcow2 \
--datastore default
sleep 5
done

onetemplate create \
--name "CentOS-6.5_64" \
--cpu 1 \
--vcpu 1 \
--memory 512 \
--arch x86_64 \
--disk "CentOS-6.5_64" \
--nic "Test Network" \
--context DNS=8.8.8.8 \
--ssh /var/lib/one/.ssh/id_rsa.pub \
--vnc

EOF

exit 0
